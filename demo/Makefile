# This target generates a core WebAssembly module with a custom section
# containing the component type information in it. This .wasm file can then be
# used with wasm-tools component new to create a WebAssembly Component Module.
embed:
	wasm-tools component embed wit/python.wit demo.wat -o demo-embed.wasm

# This target generates the WebAssembly Component Module using the wasm module
# with the custom section generated by the embed target.
component:
	wasm-tools component new -v -o demo-component.wasm demo-embed.wasm

# This target prints the core WebAssembly module with the custom section added
# to it.
print-embed:
	wasm-tools objdump demo-embed.wasm

print-component:
	wasm-tools print demo-component.wasm

# Generates the Python bindings for the component.
bindings:
	python3 -m wasmtime.bindgen demo-component.wasm --out-dir dist

run:
	python3 demo.py

all: embed component bindings run
